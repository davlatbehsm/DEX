<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>DEX 6.0 SECURE</title>
<style>
:root {
    --bg: #0f1621; --card: #17212b; --primary: #5288c1; --text: #ffffff;
    --text-dim: #7f91a4; --msg-out: #2b5278; --msg-in: #182533; --red: #ff595a;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; background: #000; color: var(--text); font-family: -apple-system, sans-serif; height: 100dvh; overflow: hidden; }
.app { width: 100%; height: 100%; max-width: 500px; margin: 0 auto; background: var(--bg); display: flex; flex-direction: column; position: relative; }

/* –≠–ö–†–ê–ù–´ */
.screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; flex-direction: column; z-index: 10; }
.screen.active { display: flex; animation: slide 0.2s ease-out; }
@keyframes slide { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* –ò–ù–¢–ï–†–§–ï–ô–° */
header { height: 60px; background: var(--card); display: flex; align-items: center; padding: 0 16px; justify-content: space-between; z-index: 20; box-shadow: 0 2px 10px rgba(0,0,0,0.4); }
.content { flex: 1; overflow-y: auto; padding-bottom: 80px; }
.tab-bar { height: 65px; background: var(--card); display: flex; justify-content: space-around; border-top: 1px solid #000; padding-bottom: env(safe-area-inset-bottom); }
.tab { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: var(--text-dim); cursor: pointer; }
.tab.active { color: var(--primary); }

/* –ß–ê–¢–´ */
.list-item { display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid #1c252f; cursor: pointer; }
.avatar { width: 52px; height: 52px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; margin-right: 15px; background-size: cover; }
.preview { color: var(--text-dim); font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 4px; }

/* –°–û–û–ë–©–ï–ù–ò–Ø */
.bubble { max-width: 80%; padding: 10px 14px; border-radius: 16px; margin-bottom: 8px; font-size: 15px; position: relative; }
.me { background: var(--msg-out); align-self: flex-end; border-bottom-right-radius: 4px; margin-left: auto; }
.other { background: var(--msg-in); align-self: flex-start; border-bottom-left-radius: 4px; }
.time { font-size: 10px; color: rgba(255,255,255,0.5); float: right; margin: 5px -5px -5px 8px; }

/* –í–í–û–î */
.input-group { padding: 30px; display: flex; flex-direction: column; gap: 15px; height: 100%; justify-content: center; }
input { background: var(--card); border: 1px solid #2f3b47; color: #fff; padding: 15px; border-radius: 12px; font-size: 16px; }
.btn { background: var(--primary); color: #fff; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; }
.btn-sec { background: #242f3d; }

/* MODAL */
.modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:100; display:none; align-items:center; justify-content:center; padding:20px; }
.modal-box { background: var(--card); padding:20px; border-radius:15px; width:100%; max-width:400px; }
</style>
</head>
<body>

<div class="app">

    <div id="scr-auth" class="screen active">
        <div class="input-group">
            <h1 style="text-align:center; color:var(--primary); font-size:40px; margin:0">DEX</h1>
            <p style="text-align:center; color:var(--text-dim); margin-bottom:20px">–í—Ö–æ–¥ –≤ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —á–∞—Ç</p>
            <input id="inUser" placeholder="–õ–æ–≥–∏–Ω">
            <input id="inPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn" onclick="Auth.handle()">–í–æ–π—Ç–∏ / –°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>

    <div id="scr-main" class="screen">
        <header><div style="font-weight:bold; font-size:20px" id="mainTitle">–ß–∞—Ç—ã</div></header>
        <div id="view-chats" class="content"></div>
        <div id="view-search" class="content" style="display:none; padding:15px">
            <input id="searchIn" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∏–Ω—É..." style="width:100%" oninput="Search.go()">
            <div id="searchRes" style="margin-top:15px"></div>
        </div>
        <div id="view-prof" class="content" style="display:none; padding:20px; text-align:center">
            <div id="myAv" class="avatar" style="width:100px; height:100px; margin:0 auto 20px; font-size:40px"></div>
            <h2 id="myName">User</h2>
            <button class="btn btn-sec" style="width:100%" onclick="Sync.showExport()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–æ–∏–º ID</button>
            <button class="btn btn-sec" style="width:100%; margin-top:10px" onclick="Sync.showImport()">üì• –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞ –ø–æ ID</button>
            <hr style="opacity:0.1; margin:20px 0">
            <button class="btn" style="width:100%; background:var(--red)" onclick="location.reload()">–í—ã–π—Ç–∏</button>
        </div>
        <div class="tab-bar">
            <div class="tab active" onclick="Tabs.go('chats', this)"><span>üí¨</span>–ß–∞—Ç—ã</div>
            <div class="tab" onclick="Tabs.go('search', this)"><span>üîç</span>–ü–æ–∏—Å–∫</div>
            <div class="tab" onclick="Tabs.go('prof', this)"><span>üë§</span>–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
    </div>

    <div id="scr-chat" class="screen">
        <header>
            <div style="display:flex; align-items:center; gap:12px">
                <div onclick="Chat.close()" style="cursor:pointer; font-size:24px">‚Üê</div>
                <div id="chatAv" class="avatar" style="width:38px; height:38px; margin:0; font-size:16px"></div>
                <div id="chatName" style="font-weight:bold">Name</div>
            </div>
        </header>
        <div id="msgList" class="content" style="padding:15px; display:flex; flex-direction:column"></div>
        <div style="padding:10px; background:var(--card); display:flex; gap:10px; align-items:center">
            <input id="msgIn" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; margin:0; padding:10px">
            <button onclick="Chat.send()" style="background:var(--primary); border:none; color:#fff; width:40px; height:40px; border-radius:50%; cursor:pointer">‚û§</button>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-box">
            <h3 id="modalTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
            <p id="modalText" style="word-break:break-all; font-size:12px; color:var(--text-dim)"></p>
            <input id="modalIn" style="display:none; width:100%; margin-bottom:15px">
            <button class="btn" style="width:100%" id="modalBtn">OK</button>
            <button class="btn btn-sec" style="width:100%; margin-top:8px" onclick="document.getElementById('modal').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

</div>

<script>
const DB = {
    me: null,
    data: JSON.parse(localStorage.getItem('dex_v6')) || { users: {}, chats: {} },
    save() { localStorage.setItem('dex_v6', JSON.stringify(this.data)); },
    cid(u1, u2) { return [u1, u2].sort().join('::'); }
};

const Auth = {
    handle() {
        const u = inUser.value.trim(), p = inPass.value.trim();
        if(!u || !p) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë!");
        
        if(!DB.data.users[u]) {
            DB.data.users[u] = { pass: p, bio: "Hi!" };
            DB.data.chats[DB.cid(u, u)] = [{f:'System', t:'–í–∞—à–µ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ', d:'now'}];
            alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!");
        } else if(DB.data.users[u].pass !== p) {
            return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
        }
        
        DB.me = u;
        Tabs.go('chats', document.querySelector('.tab'));
        scr_auth.classList.remove('active');
        scr_main.classList.add('active');
        myName.innerText = u;
        myAv.innerText = u[0].toUpperCase();
    }
};

const Tabs = {
    go(t, el) {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        ['chats', 'search', 'prof'].forEach(v => document.getElementById('view-'+v).style.display = (v==t?'block':'none'));
        mainTitle.innerText = t=='chats'?'–ß–∞—Ç—ã':(t=='search'?'–ü–æ–∏—Å–∫':'–ü—Ä–æ—Ñ–∏–ª—å');
        if(t=='chats') this.renderChats();
    },
    renderChats() {
        const v = document.getElementById('view-chats'); v.innerHTML = "";
        Object.keys(DB.data.chats).forEach(id => {
            if(id.includes(DB.me)) {
                const partner = id.split('::').find(x => x != DB.me) || DB.me;
                const msgs = DB.data.chats[id];
                const last = msgs[msgs.length-1];
                v.innerHTML += `
                    <div class="list-item" onclick="Chat.open('${partner}')">
                        <div class="avatar">${partner[0].toUpperCase()}</div>
                        <div style="flex:1">
                            <div style="font-weight:bold">${partner == DB.me ? '‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ' : partner}</div>
                            <div class="preview">${last.t}</div>
                        </div>
                    </div>`;
            }
        });
    }
};

const Chat = {
    target: null,
    open(u) {
        this.target = u;
        chatName.innerText = u == DB.me ? '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' : u;
        chatAv.innerText = u[0].toUpperCase();
        scr_chat.classList.add('active');
        this.render();
    },
    close() { scr_chat.classList.remove('active'); Tabs.renderChats(); },
    render() {
        const list = document.getElementById('msgList'); list.innerHTML = "";
        const cid = DB.cid(DB.me, this.target);
        (DB.data.chats[cid] || []).forEach(m => {
            list.innerHTML += `<div class="bubble ${m.f==DB.me?'me':'other'}">${m.t}<span class="time">${m.d}</span></div>`;
        });
        list.scrollTop = list.scrollHeight;
    },
    send() {
        const t = msgIn.value.trim(); if(!t) return;
        const cid = DB.cid(DB.me, this.target);
        if(!DB.data.chats[cid]) DB.data.chats[cid] = [];
        DB.data.chats[cid].push({f:DB.me, t:t, d:new Date().toLocaleTimeString().slice(0,5)});
        DB.save(); msgIn.value = ""; this.render();
    }
};

const Search = {
    go() {
        const q = searchIn.value.trim().toLowerCase();
        const res = document.getElementById('searchRes'); res.innerHTML = "";
        if(!q) return;
        Object.keys(DB.data.users).forEach(u => {
            if(u.toLowerCase().includes(q) && u != DB.me) {
                res.innerHTML += `<div class="list-item" onclick="Chat.open('${u}')"><div class="avatar">${u[0]}</div>${u}</div>`;
            }
        });
    }
};

const Sync = {
    showExport() {
        const modal = document.getElementById('modal');
        modal.style.display = 'flex';
        modalTitle.innerText = "–¢–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π ID";
        modalText.innerText = btoa(JSON.stringify({u: DB.me, b: DB.data.users[DB.me].bio}));
        modalIn.style.display = 'none';
        modalBtn.onclick = () => modal.style.display = 'none';
    },
    showImport() {
        const modal = document.getElementById('modal');
        modal.style.display = 'flex';
        modalTitle.innerText = "–í—Å—Ç–∞–≤—å ID –¥—Ä—É–≥–∞";
        modalText.innerText = "–ü–æ–ø—Ä–æ—Å–∏ –¥—Ä—É–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ ID –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –ø—Ä–∏—à–ª–∏ —Ç–µ–±–µ.";
        modalIn.style.display = 'block'; modalIn.value = "";
        modalBtn.onclick = () => {
            try {
                const data = JSON.parse(atob(modalIn.value));
                if(!DB.data.users[data.u]) {
                    DB.data.users[data.u] = { bio: data.b, pass: 'external' };
                    DB.save();
                    alert("–î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω! –¢–µ–ø–µ—Ä—å –Ω–∞–π–¥–∏ –µ–≥–æ –≤ –ø–æ–∏—Å–∫–µ.");
                }
                modal.style.display = 'none';
            } catch(e) { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!"); }
        };
    }
};
</script>
</body>
</html>

