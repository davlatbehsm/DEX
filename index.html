<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEX 2.0 - Telegram Clone</title>
<style>
:root {
  --bg-color: #0e1621;
  --header-color: #17212b;
  --input-bg: #1f2933;
  --accent: #2aabee;
  --msg-me: #2b5278;
  --msg-other: #182533;
  --text: #ffffff;
  --text-dim: #a8b1b8;
}

* { box-sizing: border-box; transition: 0.2s ease-in-out; }
body {
  margin: 0; font-family: 'Segoe UI', Roboto, sans-serif;
  background: #070d14; color: var(--text); overflow: hidden;
}

.app {
  max-width: 500px; margin: auto; height: 100vh;
  background: var(--bg-color); display: flex; flex-direction: column;
  position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* Header */
header {
  background: var(--header-color); padding: 15px;
  display: flex; align-items: center; justify-content: space-between;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
}
.header-title { font-size: 19px; font-weight: 600; }
.header-icon { cursor: pointer; font-size: 20px; padding: 5px; }

/* Screens */
.screen { display: none; flex-direction: column; height: 100%; overflow-y: auto; }
.screen.active { display: flex; }

/* Components */
input {
  background: var(--input-bg); border: none; padding: 14px;
  border-radius: 10px; color: #fff; width: 100%; margin-bottom: 10px;
}
button {
  background: var(--accent); color: #fff; border: none;
  padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer;
}
button:active { transform: scale(0.98); }

/* Chat List */
.search-container { padding: 10px; background: var(--bg-color); }
.chat-item {
  display: flex; align-items: center; padding: 12px;
  cursor: pointer; border-bottom: 1px solid #131c26;
}
.chat-item:hover { background: #17212b; }
.avatar {
  width: 50px; height: 50px; border-radius: 50%;
  background: linear-gradient(45deg, #2aabee, #229ed9);
  display: flex; align-items: center; justify-content: center;
  font-weight: bold; font-size: 20px; margin-right: 15px;
}
.chat-info { flex: 1; }
.chat-top { display: flex; justify-content: space-between; margin-bottom: 4px; }
.chat-name { font-weight: 600; font-size: 16px; }
.chat-last { font-size: 14px; color: var(--text-dim); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px;}

/* Messages Area */
.messages-container {
  flex: 1; overflow-y: auto; padding: 15px;
  background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
  background-blend-mode: overlay;
}
.msg-bubble {
  max-width: 80%; padding: 8px 12px; border-radius: 12px;
  margin-bottom: 8px; position: relative; font-size: 15px;
  word-wrap: break-word; line-height: 1.4;
}
.msg-bubble.me { background: var(--msg-me); align-self: flex-end; border-bottom-right-radius: 2px; margin-left: auto; }
.msg-bubble.other { background: var(--msg-other); align-self: flex-start; border-bottom-left-radius: 2px; }

/* Input Bar */
.input-bar {
  background: var(--header-color); padding: 10px;
  display: flex; gap: 8px; align-items: center;
}
#msgText { margin-bottom: 0; }

/* Profile & Notes */
.profile-card { text-align: center; padding: 20px; }
.big-avatar {
  width: 100px; height: 100px; border-radius: 50%; background: var(--accent);
  margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px;
}
.note-item {
  background: #1f2933; margin: 10px; padding: 12px; border-radius: 8px;
  display: flex; justify-content: space-between; align-items: center;
}
.delete-btn { color: #ff595a; cursor: pointer; font-size: 18px; }

.bottom-nav {
  display: flex; background: var(--header-color); border-top: 1px solid #000;
}
.nav-item {
  flex: 1; text-align: center; padding: 12px; cursor: pointer; color: var(--text-dim);
}
.nav-item.active { color: var(--accent); }
</style>
</head>
<body>

<div class="app">
  <header>
    <div class="header-icon" id="backBtn" style="visibility: hidden;">‚Üê</div>
    <div class="header-title" id="mainTitle">DEX</div>
    <div class="header-icon" id="profileToggle">üë§</div>
  </header>

  <div id="screen-reg" class="screen" style="padding: 20px; justify-content: center;">
    <h2 style="text-align: center;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
    <input id="regUser" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
    <input id="regPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button id="regBtn">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
  </div>

  <div id="screen-list" class="screen active">
    <div class="search-container">
      <input id="searchInput" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...">
    </div>
    <div id="chatList"></div>
  </div>

  <div id="screen-chat" class="screen">
    <div class="messages-container" id="msgContainer"></div>
    <div class="input-bar">
      <input id="msgText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
      <button id="sendBtn">‚û§</button>
    </div>
  </div>

  <div id="screen-profile" class="screen">
    <div class="profile-card">
      <div class="big-avatar" id="profChar">?</div>
      <h3 id="profNameDisplay">User</h3>
      <input id="editName" placeholder="–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è">
      <button id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </div>
    <hr style="width: 90%; opacity: 0.1;">
    <div style="padding: 15px;">
      <h4>üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h4>
      <div style="display: flex; gap: 5px;">
        <input id="noteInput" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..." style="margin:0">
        <button id="addNoteBtn">+</button>
      </div>
      <div id="notesList"></div>
    </div>
    <button id="logoutBtn" style="background:#444; margin: 20px;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
  </div>

  <div class="bottom-nav" id="mainNav">
    <div class="nav-item active" onclick="showTab('list')">–ß–∞—Ç—ã</div>
    <div class="nav-item" onclick="showTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
  </div>
</div>

<script>
// --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ---
let db = JSON.parse(localStorage.getItem('dex_db')) || {
  users: {}, // {username: {pass, name, notes}}
  chats: { "Global": [{from: "System", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Ç!"}] }
};
let currentUser = localStorage.getItem('dex_logged');
let activeChat = null;

const saveDB = () => localStorage.setItem('dex_db', JSON.stringify(db));

// --- –†–û–£–¢–ò–ù–ì (–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤) ---
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + screenId).classList.add('active');
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –ù–∞–∑–∞–¥ –∏ –ù–∞–≤–∏–≥–∞—Ü–∏–µ–π
  backBtn.style.visibility = (screenId === 'chat') ? 'visible' : 'hidden';
  mainNav.style.display = (screenId === 'list' || screenId === 'profile') ? 'flex' : 'none';
  
  if(screenId === 'list') mainTitle.innerText = "DEX";
}

function showTab(tab) {
  document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
  if (tab === 'list') {
    document.querySelectorAll('.nav-item')[0].classList.add('active');
    renderChats();
    showScreen('list');
  } else {
    document.querySelectorAll('.nav-item')[1].classList.add('active');
    renderProfile();
    showScreen('profile');
  }
}

// --- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ---
regBtn.onclick = () => {
  const u = regUser.value.trim();
  const p = regPass.value.trim();
  if(!u || !p) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ");
  if(!db.users[u]) {
    db.users[u] = { pass: p, name: u, notes: [] };
    saveDB();
  }
  currentUser = u;
  localStorage.setItem('dex_logged', u);
  showTab('list');
};

// --- –°–ü–ò–°–û–ö –ß–ê–¢–û–í ---
function renderChats() {
  const list = document.getElementById('chatList');
  list.innerHTML = "";
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (Saved Messages)
  const savedLast = (db.users[currentUser].notes.length > 0) ? "–ó–∞–º–µ—Ç–∫–∏..." : "–¢—É—Ç –ø—É—Å—Ç–æ";
  createChatItem(list, "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–ó–∞–º–µ—Ç–∫–∏)", savedLast, "‚≠ê", () => showTab('profile'));
  
  // –°–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö —á–∞—Ç–æ–≤
  Object.keys(db.chats).forEach(chatName => {
    const lastMsg = db.chats[chatName].slice(-1)[0];
    createChatItem(list, chatName, lastMsg.text, chatName[0], () => openChat(chatName));
  });
}

function createChatItem(container, name, last, icon, onClick) {
  const item = document.createElement('div');
  item.className = 'chat-item';
  item.onclick = onClick;
  item.innerHTML = `
    <div class="avatar">${icon}</div>
    <div class="chat-info">
      <div class="chat-top"><span class="chat-name">${name}</span></div>
      <div class="chat-last">${last}</div>
    </div>
  `;
  container.appendChild(item);
}

// --- –°–û–û–ë–©–ï–ù–ò–Ø ---
function openChat(name) {
  activeChat = name;
  mainTitle.innerText = name;
  showScreen('chat');
  renderMessages();
}

function renderMessages() {
  const container = document.getElementById('msgContainer');
  container.innerHTML = "";
  db.chats[activeChat].forEach((m, idx) => {
    const div = document.createElement('div');
    div.className = `msg-bubble ${m.from === currentUser ? 'me' : 'other'}`;
    div.innerHTML = `
      <div style="font-size:12px; color:var(--accent); font-weight:bold">${m.from}</div>
      ${m.text}
      <div style="font-size:10px; text-align:right; opacity:0.5; margin-top:4px">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
    `;
    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –¥–æ–ª–≥–æ–º—É –Ω–∞–∂–∞—Ç–∏—é
    if(m.from === currentUser) {
        div.oncontextmenu = (e) => {
            e.preventDefault();
            if(confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) {
                db.chats[activeChat].splice(idx, 1);
                saveDB();
                renderMessages();
            }
        };
    }
    container.appendChild(div);
  });
  container.scrollTop = container.scrollHeight;
}

sendBtn.onclick = () => {
  const txt = msgText.value.trim();
  if(!txt) return;
  db.chats[activeChat].push({ from: currentUser, text: txt });
  msgText.value = "";
  saveDB();
  renderMessages();
};

// --- –ü–†–û–§–ò–õ–¨ –ò –ó–ê–ú–ï–¢–ö–ò ---
function renderProfile() {
  const user = db.users[currentUser];
  profNameDisplay.innerText = user.name;
  profChar.innerText = user.name[0].toUpperCase();
  editName.value = user.name;
  
  const nList = document.getElementById('notesList');
  nList.innerHTML = "";
  user.notes.forEach((note, idx) => {
    const div = document.createElement('div');
    div.className = 'note-item';
    div.innerHTML = `<span>${note}</span> <span class="delete-btn" onclick="deleteNote(${idx})">√ó</span>`;
    nList.appendChild(div);
  });
}

saveProfileBtn.onclick = () => {
  db.users[currentUser].name = editName.value;
  saveDB();
  alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
  renderProfile();
};

addNoteBtn.onclick = () => {
  const txt = noteInput.value.trim();
  if(!txt) return;
  db.users[currentUser].notes.push(txt);
  noteInput.value = "";
  saveDB();
  renderProfile();
};

window.deleteNote = (idx) => {
  db.users[currentUser].notes.splice(idx, 1);
  saveDB();
  renderProfile();
};

// --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
backBtn.onclick = () => showTab('list');
profileToggle.onclick = () => showTab('profile');
logoutBtn.onclick = () => {
  localStorage.removeItem('dex_logged');
  location.reload();
};

// –ê–≤—Ç–æ-–≤—Ö–æ–¥
if(currentUser && db.users[currentUser]) {
  showTab('list');
} else {
  showScreen('reg');
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEX 2.0 - Telegram Clone</title>
<style>
:root {
  --bg-color: #0e1621;
  --header-color: #17212b;
  --input-bg: #1f2933;
  --accent: #2aabee;
  --msg-me: #2b5278;
  --msg-other: #182533;
  --text: #ffffff;
  --text-dim: #a8b1b8;
}

* { box-sizing: border-box; transition: 0.2s ease-in-out; }
body {
  margin: 0; font-family: 'Segoe UI', Roboto, sans-serif;
  background: #070d14; color: var(--text); overflow: hidden;
}

.app {
  max-width: 500px; margin: auto; height: 100vh;
  background: var(--bg-color); display: flex; flex-direction: column;
  position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* Header */
header {
  background: var(--header-color); padding: 15px;
  display: flex; align-items: center; justify-content: space-between;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
}
.header-title { font-size: 19px; font-weight: 600; }
.header-icon { cursor: pointer; font-size: 20px; padding: 5px; }

/* Screens */
.screen { display: none; flex-direction: column; height: 100%; overflow-y: auto; }
.screen.active { display: flex; }

/* Components */
input {
  background: var(--input-bg); border: none; padding: 14px;
  border-radius: 10px; color: #fff; width: 100%; margin-bottom: 10px;
}
button {
  background: var(--accent); color: #fff; border: none;
  padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer;
}
button:active { transform: scale(0.98); }

/* Chat List */
.search-container { padding: 10px; background: var(--bg-color); }
.chat-item {
  display: flex; align-items: center; padding: 12px;
  cursor: pointer; border-bottom: 1px solid #131c26;
}
.chat-item:hover { background: #17212b; }
.avatar {
  width: 50px; height: 50px; border-radius: 50%;
  background: linear-gradient(45deg, #2aabee, #229ed9);
  display: flex; align-items: center; justify-content: center;
  font-weight: bold; font-size: 20px; margin-right: 15px;
}
.chat-info { flex: 1; }
.chat-top { display: flex; justify-content: space-between; margin-bottom: 4px; }
.chat-name { font-weight: 600; font-size: 16px; }
.chat-last { font-size: 14px; color: var(--text-dim); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px;}

/* Messages Area */
.messages-container {
  flex: 1; overflow-y: auto; padding: 15px;
  background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
  background-blend-mode: overlay;
}
.msg-bubble {
  max-width: 80%; padding: 8px 12px; border-radius: 12px;
  margin-bottom: 8px; position: relative; font-size: 15px;
  word-wrap: break-word; line-height: 1.4;
}
.msg-bubble.me { background: var(--msg-me); align-self: flex-end; border-bottom-right-radius: 2px; margin-left: auto; }
.msg-bubble.other { background: var(--msg-other); align-self: flex-start; border-bottom-left-radius: 2px; }

/* Input Bar */
.input-bar {
  background: var(--header-color); padding: 10px;
  display: flex; gap: 8px; align-items: center;
}
#msgText { margin-bottom: 0; }

/* Profile & Notes */
.profile-card { text-align: center; padding: 20px; }
.big-avatar {
  width: 100px; height: 100px; border-radius: 50%; background: var(--accent);
  margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px;
}
.note-item {
  background: #1f2933; margin: 10px; padding: 12px; border-radius: 8px;
  display: flex; justify-content: space-between; align-items: center;
}
.delete-btn { color: #ff595a; cursor: pointer; font-size: 18px; }

.bottom-nav {
  display: flex; background: var(--header-color); border-top: 1px solid #000;
}
.nav-item {
  flex: 1; text-align: center; padding: 12px; cursor: pointer; color: var(--text-dim);
}
.nav-item.active { color: var(--accent); }
</style>
</head>
<body>

<div class="app">
  <header>
    <div class="header-icon" id="backBtn" style="visibility: hidden;">‚Üê</div>
    <div class="header-title" id="mainTitle">DEX</div>
    <div class="header-icon" id="profileToggle">üë§</div>
  </header>

  <div id="screen-reg" class="screen" style="padding: 20px; justify-content: center;">
    <h2 style="text-align: center;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
    <input id="regUser" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
    <input id="regPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button id="regBtn">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
  </div>

  <div id="screen-list" class="screen active">
    <div class="search-container">
      <input id="searchInput" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...">
    </div>
    <div id="chatList"></div>
  </div>

  <div id="screen-chat" class="screen">
    <div class="messages-container" id="msgContainer"></div>
    <div class="input-bar">
      <input id="msgText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
      <button id="sendBtn">‚û§</button>
    </div>
  </div>

  <div id="screen-profile" class="screen">
    <div class="profile-card">
      <div class="big-avatar" id="profChar">?</div>
      <h3 id="profNameDisplay">User</h3>
      <input id="editName" placeholder="–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è">
      <button id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </div>
    <hr style="width: 90%; opacity: 0.1;">
    <div style="padding: 15px;">
      <h4>üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h4>
      <div style="display: flex; gap: 5px;">
        <input id="noteInput" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..." style="margin:0">
        <button id="addNoteBtn">+</button>
      </div>
      <div id="notesList"></div>
    </div>
    <button id="logoutBtn" style="background:#444; margin: 20px;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
  </div>

  <div class="bottom-nav" id="mainNav">
    <div class="nav-item active" onclick="showTab('list')">–ß–∞—Ç—ã</div>
    <div class="nav-item" onclick="showTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
  </div>
</div>

<script>
// --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ---
let db = JSON.parse(localStorage.getItem('dex_db')) || {
  users: {}, // {username: {pass, name, notes}}
  chats: { "Global": [{from: "System", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Ç!"}] }
};
let currentUser = localStorage.getItem('dex_logged');
let activeChat = null;

const saveDB = () => localStorage.setItem('dex_db', JSON.stringify(db));

// --- –†–û–£–¢–ò–ù–ì (–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤) ---
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + screenId).classList.add('active');
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –ù–∞–∑–∞–¥ –∏ –ù–∞–≤–∏–≥–∞—Ü–∏–µ–π
  backBtn.style.visibility = (screenId === 'chat') ? 'visible' : 'hidden';
  mainNav.style.display = (screenId === 'list' || screenId === 'profile') ? 'flex' : 'none';
  
  if(screenId === 'list') mainTitle.innerText = "DEX";
}

function showTab(tab) {
  document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
  if (tab === 'list') {
    document.querySelectorAll('.nav-item')[0].classList.add('active');
    renderChats();
    showScreen('list');
  } else {
    document.querySelectorAll('.nav-item')[1].classList.add('active');
    renderProfile();
    showScreen('profile');
  }
}

// --- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ---
regBtn.onclick = () => {
  const u = regUser.value.trim();
  const p = regPass.value.trim();
  if(!u || !p) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ");
  if(!db.users[u]) {
    db.users[u] = { pass: p, name: u, notes: [] };
    saveDB();
  }
  currentUser = u;
  localStorage.setItem('dex_logged', u);
  showTab('list');
};

// --- –°–ü–ò–°–û–ö –ß–ê–¢–û–í ---
function renderChats() {
  const list = document.getElementById('chatList');
  list.innerHTML = "";
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (Saved Messages)
  const savedLast = (db.users[currentUser].notes.length > 0) ? "–ó–∞–º–µ—Ç–∫–∏..." : "–¢—É—Ç –ø—É—Å—Ç–æ";
  createChatItem(list, "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–ó–∞–º–µ—Ç–∫–∏)", savedLast, "‚≠ê", () => showTab('profile'));
  
  // –°–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö —á–∞—Ç–æ–≤
  Object.keys(db.chats).forEach(chatName => {
    const lastMsg = db.chats[chatName].slice(-1)[0];
    createChatItem(list, chatName, lastMsg.text, chatName[0], () => openChat(chatName));
  });
}

function createChatItem(container, name, last, icon, onClick) {
  const item = document.createElement('div');
  item.className = 'chat-item';
  item.onclick = onClick;
  item.innerHTML = `
    <div class="avatar">${icon}</div>
    <div class="chat-info">
      <div class="chat-top"><span class="chat-name">${name}</span></div>
      <div class="chat-last">${last}</div>
    </div>
  `;
  container.appendChild(item);
}

// --- –°–û–û–ë–©–ï–ù–ò–Ø ---
function openChat(name) {
  activeChat = name;
  mainTitle.innerText = name;
  showScreen('chat');
  renderMessages();
}

function renderMessages() {
  const container = document.getElementById('msgContainer');
  container.innerHTML = "";
  db.chats[activeChat].forEach((m, idx) => {
    const div = document.createElement('div');
    div.className = `msg-bubble ${m.from === currentUser ? 'me' : 'other'}`;
    div.innerHTML = `
      <div style="font-size:12px; color:var(--accent); font-weight:bold">${m.from}</div>
      ${m.text}
      <div style="font-size:10px; text-align:right; opacity:0.5; margin-top:4px">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
    `;
    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –¥–æ–ª–≥–æ–º—É –Ω–∞–∂–∞—Ç–∏—é
    if(m.from === currentUser) {
        div.oncontextmenu = (e) => {
            e.preventDefault();
            if(confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) {
                db.chats[activeChat].splice(idx, 1);
                saveDB();
                renderMessages();
            }
        };
    }
    container.appendChild(div);
  });
  container.scrollTop = container.scrollHeight;
}

sendBtn.onclick = () => {
  const txt = msgText.value.trim();
  if(!txt) return;
  db.chats[activeChat].push({ from: currentUser, text: txt });
  msgText.value = "";
  saveDB();
  renderMessages();
};

// --- –ü–†–û–§–ò–õ–¨ –ò –ó–ê–ú–ï–¢–ö–ò ---
function renderProfile() {
  const user = db.users[currentUser];
  profNameDisplay.innerText = user.name;
  profChar.innerText = user.name[0].toUpperCase();
  editName.value = user.name;
  
  const nList = document.getElementById('notesList');
  nList.innerHTML = "";
  user.notes.forEach((note, idx) => {
    const div = document.createElement('div');
    div.className = 'note-item';
    div.innerHTML = `<span>${note}</span> <span class="delete-btn" onclick="deleteNote(${idx})">√ó</span>`;
    nList.appendChild(div);
  });
}

saveProfileBtn.onclick = () => {
  db.users[currentUser].name = editName.value;
  saveDB();
  alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
  renderProfile();
};

addNoteBtn.onclick = () => {
  const txt = noteInput.value.trim();
  if(!txt) return;
  db.users[currentUser].notes.push(txt);
  noteInput.value = "";
  saveDB();
  renderProfile();
};

window.deleteNote = (idx) => {
  db.users[currentUser].notes.splice(idx, 1);
  saveDB();
  renderProfile();
};

// --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
backBtn.onclick = () => showTab('list');
profileToggle.onclick = () => showTab('profile');
logoutBtn.onclick = () => {
  localStorage.removeItem('dex_logged');
  location.reload();
};

// –ê–≤—Ç–æ-–≤—Ö–æ–¥
if(currentUser && db.users[currentUser]) {
  showTab('list');
} else {
  showScreen('reg');
}
</script>

</body>
</html>

